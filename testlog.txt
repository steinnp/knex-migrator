
> knex-migrator@3.1.4 test /Users/steinn/Documents/KTH-2018-1/DD2480/dd2480-3/knex-migrator
> npm run lint && LEVEL=fatal _mocha --require test/utils.js --report lcovonly -- test/*_spec.js


> knex-migrator@3.1.4 lint /Users/steinn/Documents/KTH-2018-1/DD2480/dd2480-3/knex-migrator
> eslint bin lib



  Database
    ✓ kill connection2 does not kill connection 1

  Functional flow
    ✓ is database ok? --> no, because the db was never initialised
    ✓ init
    ✓ is database ok? --> yes, because user has initialised the database previously
    ✓ call init again
    ✓ is database ok? --> still yes
    ✓ add 1.1 and 1.2
    ✓ change current version
    ✓ is database ok? --> no, 1.1 and 1.2 migrations are missing
    ✓ migrate to 1.1 and 1.2
    ✓ is database ok? --> yes sure
    ✓ migrate 1.2 (--v)
    ✓ change current version
    ✓ migrate to 1.3
    ✓ change current version
    migrate to 1.4
      ✓ migrate to 1.4, but error happens in one of the scripts --> expect rollback
      ✓ migrate to 1.4, but error happens in one of the scripts --> expect rollback
      ✓ migrate to 1.4, but error happens in one of the scripts --> expect rollback
      ✓ migrate to 1.4, fixed error
    migrate to 1.5
      ✓ migrate to 1.5, but current version is 1.4 (no force)
      ✓ migrate 1.5 (--v) and force

  Functional flow
    ✓ is database ok? --> no, because the db was never initialised
    ✓ init (40ms)
    ✓ is database ok? --> yes, because user has initialised the database previously
    ✓ call init again
    ✓ is database ok? --> still yes
    ✓ add 1.1 and 1.2
    ✓ change current version
    ✓ is database ok? --> no, 1.1 and 1.2 migrations are missing (52ms)
    ✓ migrate to 1.1 and 1.2
    ✓ is database ok? --> yes sure
    ✓ migrate 1.2 (--v)
    ✓ change current version
    ✓ migrate to 1.3
    ✓ change current version
    migrate to 1.4
      ✓ migrate to 1.4, but error happens in one of the scripts --> expect rollback
      ✓ migrate to 1.4, but error happens in one of the scripts --> expect rollback
      ✓ migrate to 1.4, but error happens in one of the scripts --> expect rollback
      ✓ migrate to 1.4, fixed error
    migrate to 1.5
      ✓ migrate to 1.5, but current version is 1.4 (no force)
      ✓ migrate 1.5 (--v) and force

  Implicit Commits
    knex-migrator init
      fail #1
        ✓ expect full DML rollback
      fail #2
        ✓ expect full DDL/DML rollback
      success #1
        ✓ expect no rollback
    knex-migrator migrate
      fail #1
        ✓ expect full DDL/DML rollback (95ms)
      success #1
        ✓ expect no rollback (46ms)

  knex-migrator init functionality
    _loadConfig
      ✓ Should throw an error when initialising the function with no parameters
      ✓ Should throw an error when initialising the function with no values in the options
      ✓ Should throw an error when requiring a non existent module
      ✓ Should return a config if it has been declared
    Constructor
      ✓ should throw an error if no database is described in the migrator config
      ✓ should throw an error if no migrationPath is described in the migrator config
      ✓ should throw an error if no current version is described in the migrator config
      ✓ should set the properties currentVersion, migrationPath, subfolder, dbConfig, isMySQL

  Utils
    isGreaterThanVersion
      ✓ version has this notation: 1.1
      ✓ version has this notation: 11
      ✓ version has this notation: 11 (INT)
      ✓ version has this notation: 1.1.1
      ✓ version has this notation: 1
    readFolders
      ✓ ensure order
      ✓ ensure order
      ✓ ensure order
      ✓ ensure order


  63 passing (1s)

